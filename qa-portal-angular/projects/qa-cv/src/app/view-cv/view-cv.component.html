<div class="qa-app-title">
  Trainee - Maintain CV
</div>

<div style="display: flex; justify-content: center;">
  <mat-spinner [diameter]="70" *ngIf="loadingData"></mat-spinner>
</div>

<div *ngIf="!loadingData">
  <div
    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-size: 18px;">
    <div style="color: #004050">{{cvData?.fullName}}</div>
    <div style="margin-left: auto; color: #004050"><b>CV Status:</b> {{cvData?.status || 'New'}}</div>
  </div>

  <div class="cv-content-wrapper" (onSubmit)="onSubmit($event)">
    <section>
      <app-cv-card-base #qualCard [feedback]="qualFeedback" [canComment]="canComment" cardTitle="Qualifications"
        (feedbackChange)="onQualFeedbackChange($event)" [showOpenButton]="false">
        <app-cv-qualis [qualifications]="cvData?.allQualifications"
          (qualificationsChange)="cvData.allQualifications = $event"
          (feedbackClick)="onQualFeedbackClick($event, qualCard)" [canEdit]="canEdit">
        </app-cv-qualis>
      </app-cv-card-base>
    </section>

    <section>
      <app-cv-card-base #expCard [feedback]="workExpFeedback" [canComment]="canComment" cardTitle="Work Experience"
        (feedbackChange)="onWorkExpFeedbackChange($event)" [showOpenButton]="false">
        <app-cv-work-exp [experiences]="cvData?.allWorkExperience"
          (experiencesChange)="cvData.allWorkExperience = $event" 
          (feedbackClick)="onWorkExpFeedbackClick($event, expCard)" [canEdit]="canEdit">
        </app-cv-work-exp>
      </app-cv-card-base>
    </section>

    <section>
      <app-cv-card-base [showOpenButton]="false" cardTitle="Skills">
        <app-cv-skills [skills]="cvData?.allSkills[0]" (skillsChange)="cvData.allSkills[0] = $event"
          [canEdit]="canEdit">
        </app-cv-skills>
      </app-cv-card-base>
    </section>


    <section>
      <app-cv-card-base cardTitle="Personal Profile" [canComment]="canComment"
        [feedback]="cvData?.profile?.profileFeedback">
        <app-cv-profile [profile]="cvData?.profile" (profileChange)="cvData.profile = $event" [canEdit]="canEdit">
        </app-cv-profile>
      </app-cv-card-base>
    </section>

    <section>
      <app-cv-card-base cardTitle="Hobbies and Interests" [canComment]="canComment"
        [feedback]="cvData?.hobbies?.hobbiesFeedback">
        <app-cv-hobbies [hobbies]="cvData?.hobbies" (hobbiesChange)="cvData.hobbies = $event" [canEdit]="canEdit">
        </app-cv-hobbies>
      </app-cv-card-base>
    </section>


    <div class="button-row">
      <div style="width: 50%; display:flex; flex-direction: row; justify-content: left;">
        <button *ngIf="!canComment && cvData.status !== 'Approved'" mat-flat-button color="primary" (click)="onSave()"
          cardTitle="Save all Changes" [disabled]="!cvData || cvData.status==='For Review'">Save
        </button>
        <div *ngIf="!canComment" style="margin-right: 20px"></div>
        <button *ngIf="!canComment && allDetailsEntered() && cvData.status !== 'Approved'" mat-flat-button color="warn"
          (click)="openDialog()" cardTitle="Submit for Review" [disabled]="!cvData || cvData.status==='For Review'">Submit
        </button>

        <button *ngIf="canComment && cvData.status !== 'Approved'" mat-flat-button color="primary"
          (click)="onApproveCv()" cardTitle="Approve Cv"
          [disabled]="!cvData || cvData.status==='In Progress' || !cvData.status">Approve
        </button>
        <div *ngIf="canComment" style="margin-right: 20px"></div>
        <button *ngIf="canComment  && cvData.status !== 'Approved'" mat-flat-button color="warn" (click)="onFailCv()"
          cardTitle="Fail Cv" [disabled]="!cvData || cvData.status==='In Progress' || !cvData.status">Fail
        </button>
      </div>

      <button style="margin-left: auto;" mat-flat-button color="primary" (click)="getPDF()" cardTitle="Open PDF"
        [disabled]="!cvData || !allDetailsEntered()">View PDF
      </button>
    </div>
  </div>
</div>